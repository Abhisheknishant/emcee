<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>emcee - Kick-ass MCMC</title>
        <meta name="description" content="Kick-ass MCMC">
        <meta name="author" content="Dan Foreman-Mackey">

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
        <!--[if lt IE 9]>
        <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <link href="assets/prettify.css" type="text/css" rel="stylesheet" />

        <!-- Le styles -->
        <link rel="stylesheet" href="assets/bootstrap.min.css">
        <style type="text/css">
            body {
                padding-top: 60px;
            }
            div.row {
                padding-bottom: 10px;
            }
            section {
                padding-top: 45px;
            }
            pre.prettyprint {
                overflow: hidden;
                padding: 8px;
                border: none;
            }
            .simpleusage {
                font-family: "skippy-sharp", "Helvetica Neue", helvetica, sans-serif;
                font-size: 24pt;
            }
            .fast {
                margin-top: -20px;
                text-align: right;
            }
            .fast span {
                color: #600;
            }
            .simpleusage span.emcee {
                font-weight: bold;
                color: #008;
            }
            .simpleusage span.simple {
                text-decoration: underline;
                color: #066;
            }
            pre.deadsimple {
                box-shadow: 0 1px 5px rgba(0,0,0,.4);
                font-size: 11pt;
                border: 1px solid #aaa;
            }
            ol.install > li {
                padding-bottom: 5px;
            }
            .prelude {
                font-weight: normal;
                padding-bottom: 20px;
                text-align: right;
            }
            .alert code {
                background-color: inherit !important;
                color: inherit !important;
                border-width: 0;
            }
            .dl .btn {
                font-size: 16px;
                padding: 12px 20px;
                font-weight: normal;
                margin-top: 15px;
            }
            .dl .btn span {
                font-weight: bold;
            }
        </style>
        <link rel="stylesheet" href="assets/bootstrap-responsive.css">
        <link rel="shortcut icon" href="assets/favicon.png">

        <script type="text/javascript" src="http://use.typekit.com/phg8fgl.js"></script>
        <script type="text/javascript">try{Typekit.load();}catch(e){}</script>

    </head>

    <body>

        <div class="navbar navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <ul class="nav">
                        <li><a class="brand" href="#">emcee</a></li>
                        <li><a href="#install">Installation</a></li>
                        <li><a href="#quickstart">Basic Usage</a></li>
                        <li><a href="#advanced">Advanced Usage</a></li>
                        <li><a href="#api">API</a></li>
                        <li><a href="#faq">FAQ</a></li>
                    </ul>
                </div>
                <a href="http://github.com/dfm/emcee">
                    <img style="position: absolute; top: 0; right: 0; border: 0; z-order: 12000;"
                    src="https://a248.e.akamai.net/assets.github.com/img/e6bef7a091f5f3138b8cd40bc3e114258dd68ddf/687474703a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f7265645f6161303030302e706e67"
                    alt="fork me on github">
                </a>
            </div>
        </div>

        <div class="container">

            <div class="hero-unit">
                <h1>emcee</h1>
                <h2>The Python ensemble sampling toolkit for affine-invariant MCMC</h2>
                <p>Seriously kick-ass MCMC sampling</p>
            </div>

            <div class="row" style="margin-bottom: 20px;">
                <div class="span4">
                    <p class="prelude">
                    Once upon a time, there was
                    <a href="http://en.wikipedia.org/wiki/Metropolis%E2%80%93Hastings_algorithm">an algorithm</a>.
                    This algorithm became very popular but it turned out that there
                    were better ones. <a href="http://cims.nyu.edu/~weare/papers/d13.pdf">Some folks</a>
                    came up with a better one and <a href="http://danfm.ca">some</a>
                    <a href="http://www.astro.princeton.edu/~dstn/">other</a> <a href="http://cosmo.nyu.edu/hogg/">folks</a> implemented it in Python. It's a little crazy how
                    much it rocks.
                    </p>
                </div>
                <div class="span8">
                    <blockquote><h3>
                    emcee is an extensible, pure-Python implementation of
                    of Goodman & Weare's
                    <a href="http://cims.nyu.edu/~weare/papers/d13.pdf">Affine
                    Invariant Markov chain Monte Carlo (MCMC) Ensemble sampler</a>.
                    It's designed for Bayesian parameter estimation and it's really
                    sweet!</h3>
                    </blockquote>
                </div>
            </div>

            <section id="install">
                <div class="page-header">
                    <h1>Installation <small></small></h1>
                </div>

                <div class="row" id="install">
                    <div class="span4">
                        <h3>Prerequisites</h3>
                        <ul class="unstyled">
                            <li><strong><a href="http://numpy.scipy.org">numpy</a></strong>: Numerical Python
                                <span style="font-size: 11px;color: #999;">(you can use <strong>pip</strong> to install this)</span></li>
                            <li><strong><a href="http://www.pip-installer.org/en/latest/installing.html">pip</a></strong>
                            (optional): The Python package manager</li>
                        </ul>
                    </div>
                    <div class="span4">
                        <h3>Standard Install</h3>
                        <p>Do one of the following:</p>
                        <ol>
                            <li style="padding-bottom: 10px;"><code>sudo pip install emcee</code> or</li>
                            <li>Download <a href="https://github.com/dfm/emcee/zipball/master">the source</a> and run
                            <p style="margin-bottom: 0;"><code>sudo python setup.py install</code></p>
                            <p>in the unzipped directory.</p></li>
                        </ol>
                        <p>Then run the tests to make sure that all went as planned:</p>
                        <p style="text-align: center;"><code>python -c 'import emcee; emcee.test()'</code></p>
                    </div>
                    <div class="span4">
                        <h3>Bleeding edge</h3>
                        <p>For all the hackers in the house...
                        <em>you know what to do!</em></p>
                        <p class="dl" style="text-align: center;">
                        <a class="btn btn-large" href="https://github.com/dfm/emcee">Fork <span>emcee</span> on GitHub</a>
                        </p>
                    </div>
                </div>

            </section>

            <section id="quickstart">
                <div class="page-header">
                    <h1>Basic Usage <small>Sample code is not documentation&trade;</small></h1>
                </div>

                <div class="row">
                    <div class="span9 offset1">
                        <span class="simpleusage">
                            Using <span class="emcee">emcee</span> is dead
                            <span class="simple">simple</span>...
                        </span>
                    </div>
                </div>
                <div class="row">
                    <div class="span8 offset2">
                        <pre class="prettyprint deadsimple">
import numpy as np
import emcee

def lnprob(x, ivar):
    return -0.5*np.sum(ivar * x**2)

ndim, nwalkers = 10, 100
ivar = 1./np.random.rand(ndim)
p0 = [np.random.rand(ndim) for i in xrange(nwalkers)]

sampler = emcee.EnsembleSampler(nwalkers, ndim, lnprob, args=[ivar])
sampler.run_mcmc(p0, 1000)</pre>
                    </div>
                </div>
                <div class="row">
                    <div class="span9 offset2">
                        <p class="simpleusage fast">
                            ...and it's <span>blazingly</span> fast!
                        </p>
                    </div>
                </div>

                <div class="row">
                    <div class="span8 offset2">
                        <div class="alert">
                            <strong>Warning:</strong>
                            If you used a previous version of this code, you'll find that
                            the <code>chain</code> property is a different shape
                            <code>(nwalkers, nsteps, ndim)</code> instead of
                            <code>(nwalkers, ndim, nsteps)</code>.
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="span12">
                        <h3>So you want some more info?
                        <small>Why don't you check out some examples?</small>
                        </h3>
                    </div>
                </div>
                <div class="row">
                    <div class="span3 offset2">
                        <a href="quickstart" class="thumbnail">
                        <img src="assets/contour.png">
                        </a>
                        <h5 style="text-align:center;"><strong>Simple</strong>: Multivariate Gaussian</h5>
                        <p style="text-align:center;">Sample a Gaussian in 50 dimensions.</p>
                    </div>
                    <div class="span3 offset1">
                        <a href="rosenbrock" class="thumbnail">
                        <img src="assets/rosenbrock.png">
                        </a>
                        <h5 style="text-align:center;"><strong>Advanced</strong>: Rosenbrock Density</h5>
                        <p style="text-align:center;">Sample a highly anisotropic density in 2-dimensions
                        using multiprocessing.</p>
                    </div>
                </div>
            </section>

            <section id="advanced">
                <div class="page-header">
                    <h1>Advanced Usage</h1>
                </div>

                <div class="row">
                    <div class="span12">
                        <h3>Parallelization</h3>
                    </div>
                </div>

                <div class="row">
                    <div class="span4">
                        <p>In principle, adding <code>multiprocessing</code>
                        support is as simple as instantiating the sampler
                        object with the <code>threads</code> argument set to
                        an integer greater than 1.</p>
                        <p>In practice, this only works when your likelihood
                        function is pickleable.</p>
                    </div>
                    <div class="span8">
                        <pre class="prettyprint">
sampler = emcee.EnsembleSampler(nwalkers, ndim, lnprob, args=[means, icov], threads=15)</pre>
                    </div>
                </div>

                <div class="row">
                    <div class="span12">
                        <h3>Object-oriented approach</h3>
                    </div>
                </div>

                <div class="row">
                    <div class="span4">
                        <p>To emulate the above multivariate Gaussian example,
                        we create a class with the mean vector and covariance
                        tensor (generated as above) as properties of the object.</p>
                    </div>
                    <div class="span8">
                        <pre class="prettyprint">
class MultivariateGaussian(object):
    def __init__(self, ndim):
        self.mu = np.random.rand(ndim)
        cov  = 0.5-np.random.rand(ndim**2).reshape((ndim, ndim))
        cov  = np.triu(cov)
        cov += cov.T - np.diag(cov.diagonal())
        cov  = np.dot(cov,cov)
        self.icov = np.linalg.inv(cov)</pre>
                    </div>
                </div>
                <div class="row">
                    <div class="span4">
                        <p>Then, you can overload the magic <code>__call__</code>
                        method of the class with the log-posterior function.</p>
                    </div>
                    <div class="span8">
                        <pre class="prettyprint">
    def __call__(self, x):
        diff = x-self.mu
        return -np.dot(diff,np.dot(self.icov,diff))/2.0</pre>
                    </div>
                </div>

                <div class="row">
                    <div class="span4">
                        <p>Finally, you instantiate the sampler as follows and
                        finish the analysis as before.</p>
                    </div>
                    <div class="span8">
                        <pre class="prettyprint">
mygaussian = MultivariateGaussian(ndim)
sampler = emcee.EnsembleSampler(nwalkers, ndim, mygaussian)</pre>
                    </div>
                </div>

            </section>

            <section id="api">
                <div class="page-header">
                    <h1>API <small></small></h1>
                </div>
                <div class="row" id="faq-walkers">
                    <div class="span12">
                        <h3>Annotated source code</h3>
                        <p>The annotated source code is an excellent place to
                        get information about how this code works.
                        Most of the core functionality is in the
                        <a href="1.0.0/ensemble.html#ensemblesampler">EnsembleSampler</a>
                        object that inherits from the
                        <a href="1.0.0/sampler.html#sampler">Sampler</a>
                        abstract base class. There is also a simple
                        <a href="1.0.0/mh.html#mhsampler">Metropolis-Hastings</a>
                        sampler for comparison. You can also take a look at the
                        <a href="1.0.0/tests.html">unit tests</a>.
                    </div>
                </div>

<div class="row">
    <div class="span10 offset1">
        <h3><small>emcee.</small>Sampler <small>(dim, lnprobfn, args=[])</small></h3>
        <p>An abstract sampler object that implements various helper functions</p>
    </div>
</div>
<div class="row">
    <div class="span10 offset1">
        <h4>Arguments</h4>
        <ul>
            <li><code>dim</code> (int): Number of dimensions in the parameter space.</li>
            <li><code>lnpostfn</code> (callable): A function that takes a vector in the parameter space as input and returns the natural logarithm of the posterior probability for that position.</li>
        </ul>
    </div>
</div>
<div class="row">
    <div class="span10 offset1">
        <h4>Keyword Arguments</h4>
        <ul>
            <li><code>args</code> (list): Optional list of extra arguments for `lnpostfn`. `lnpostfn` will be called with the sequence `lnpostfn(p,</li>
        </ul>
    </div>
</div>



<div class="row">
    <div class="span10 offset1">
        <h3><small>emcee.</small>EnsembleSampler <small>(k, *args, **kwargs)</small></h3>
        <p>A generalized Ensemble sampler that uses 2 ensembles for parallelization.</p>
<p>This is a subclass of the <code>Sampler</code> object. See [[sampler.py#sampler]]
for more details about the inherited properties.</p>
    </div>
</div>
<div class="row">
    <div class="span10 offset1">
        <h4>Arguments</h4>
        <ul>
            <li><code>k</code> (int): The number of Goodman & Weare "walkers".</li>
            <li><code>dim</code> (int): Number of dimensions in the parameter space.</li>
            <li><code>lnpostfn</code> (callable): A function that takes a vector in the parameter space as input and returns the natural logarithm of the posterior probability for that position.</li>
        </ul>
    </div>
</div>
<div class="row">
    <div class="span10 offset1">
        <h4>Keyword Arguments</h4>
        <ul>
            <li><code>a</code> (float): The proposal scale parameter. (default: `2.0`)</li>
            <li><code>args</code> (list): Optional list of extra arguments for `lnpostfn`. `lnpostfn` will be called with the sequence `lnpostfn(p,</li>
            <li><code>postargs</code> (list): Alias of `args` for backwards compatibility.</li>
            <li><code>threads</code> (int): The number of threads to use for parallelization. If `threads == 1`, then the `multiprocessing` module is not used but if `threads > 1`, then a `Pool` object is created and calls to `lnpostfn` are run in parallel. (default: 1)</li>
            <li><code>pool</code> (multiprocessing.Pool): An alternative method of using the parallelized algorithm. If `pool is not None`, the value of `threads` is ignored and the provided `Pool` is used for all parallelization. (default: `None`)</li>
        </ul>
    </div>
</div>



<div class="row">
    <div class="span10 offset1">
        <h3><small>emcee.</small>Ensemble <small>(sampler)</small></h3>
        <p>A sub-ensemble object that actually does the heavy lifting of the
likelihood calculations and proposals of a new position.</p>
    </div>
</div>
<div class="row">
    <div class="span10 offset1">
        <h4>Arguments</h4>
        <ul>
            <li><code>sampler</code> (Sampler): The sampler object that this sub-ensemble should be connected to.</li>
        </ul>
    </div>
</div>

            </section>

            <section id="faq">
                <div class="page-header">
                    <h1>FAQ <small>The not-so-frequently asked questions that still have useful answers</small></h1>
                </div>

                <div class="row" id="faq-walkers">
                    <div class="span12">
                        <h4>What are you talking about when you say "walkers"?</h4>
                        <p>Walkers are the members of the ensemble. They are almost like
                        separate Metropolis-Hastings chains but, of course, the proposal
                        distribution for a given walker depends on the positions of
                        all the other walkers in the ensemble. See
                        <a href="http://cims.nyu.edu/~weare/papers/d13.pdf">Goodman &amp; Weare (2010)</a>
                        for more details.</p>
                    </div>
                </div>

                <div class="row" id="faq-init">
                    <div class="span12">
                        <h4>How should I initialize the walkers?</h4>
                        <p>The best technique seems to be to start in a small ball
                        around the <em>a priori</em> preferred position. Don't worry,
                        the walkers quickly branch out and explore the rest of the space.</p>
                    </div>
                </div>

                <div class="row" id="faq-spikes">
                    <div class="span12">
                        <h4>I'm getting weird spikes in my data/I have low acceptance
                            fractions/both... what should I do?</h4>
                        <p>Double the number of walkers. If that doesn't work,
                        double it again. And again. Until you run out of RAM.
                        At that point, I don't know!</p>
                    </div>
                </div>

                <div class="row" id="faq-lowlike">
                    <div class="span12">
                        <h4>The walkers are getting stuck in "islands" of low
                            likelihood. How can I fix that?</h4>
                        <p>Try increasing the number of walkers. If that doesn't
                        work, you can try pruning using a clustering algorithm
                        like the one found in
                        <a href="http://arxiv.org/abs/1104.2612">arxiv:1104.2612</a>.
                        </p>
                    </div>
                </div>
            </section>

            <footer>
                <p style="text-align: center;">&copy; 2012 <a href="http://danfm.ca">Dan Foreman-Mackey</a> et al., GPLv2 License</em></p>
            </footer>

        </div> <!-- /container -->

        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>
        <script type="text/javascript" src="assets/prettify.js"></script>
        <script>$(function () { prettyPrint() })</script>

        <script type="text/javascript">
            var _gaq = _gaq || [];
            _gaq.push(['_setAccount', 'UA-22909046-1']);
            _gaq.push(['_trackPageview']);
            (function() {
                var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                })();
        </script>

    </body>
</html>

