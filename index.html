<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>PyEST - Kick-ass MCMC</title>
        <meta name="description" content="Kick-ass MCMC">
        <meta name="author" content="Dan Foreman-Mackey">

        <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
        <!--[if lt IE 9]>
        <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <link href="prettify.css" type="text/css" rel="stylesheet" />

        <!-- Le styles -->
        <link rel="stylesheet" href="bootstrap.min.css">
        <style type="text/css">
            body {
                padding-top: 60px;
            }
            div.row {
                padding-bottom: 10px;
            }
            section {
                padding-top: 45px;
            }
            pre.prettyprint {
                overflow: hidden;
                padding: 8px;
                border: none;
            }
            ol.install > li {
                padding-bottom: 5px;
            }
            .prelude {
                padding-bottom: 20px;
            }
        </style>

        <!-- Le fav and touch icons -->
        <!--
        <link rel="shortcut icon" href="images/favicon.ico">
        <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
        <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
        <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
        -->


    </head>

    <body>

        <div class="topbar">
            <div class="fill">
                <div class="container">
                    <a class="brand" href="#">The Python Ensemble Sampling Toolkit</a>
                    <ul class="nav">
                        <li><a href="#install">Installation</a></li>
                        <li><a href="#quickstart">Quickstart</a></li>
                        <li><a href="#api">API</a></li>
                        <li><a href="#faq">FAQ</a></li>
                    </ul>
                </div>
        <a href="http://github.com/dfm/PyEST">
            <img style="position: absolute; top: 0; right: 0; border: 0; z-order: 12000;"
            src="https://a248.e.akamai.net/assets.github.com/img/e6bef7a091f5f3138b8cd40bc3e114258dd68ddf/687474703a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f7265645f6161303030302e706e67"
            alt="fork me on github">
        </a>

            </div>
        </div>

        <div class="container">

            <!-- Main hero unit for a primary marketing message or call to action -->
            <div class="hero-unit">
                <h1>PyEST</h1>
                <h2>The Python Ensemble Sampling Toolkit</h2>
                <p>Seriously kick-ass MCMC sampling</p>
            </div>

            <!-- Example row of columns -->
            <div class="row">
                <div class="span16" style="padding-bottom: 20px;">
                    <h3 class="prelude">
                    Once upon a time, there was
                    <a href="http://en.wikipedia.org/wiki/Metropolis%E2%80%93Hastings_algorithm">an algorithm</a>.
                    This algorithm became very popular but it turned out that there
                    were better ones. <a href="http://cims.nyu.edu/~weare/papers/d13.pdf">Some folks</a>
                    came up with a better one and some
                    other folks implemented it in Python. It's a little crazy how
                    much it rocks.
                    </h3>
                    <h3>
                    PyEST is an extensible, pure-Python implementation of
                    of Goodman & Weare's
                    <a href="http://cims.nyu.edu/~weare/papers/d13.pdf">Affine
                    Invariant Markov chain Monte Carlo (MCMC) sampler</a>.
                    It's designed for Bayesian parameter estimation and it's really
                    fast.
                    </h3>
                </div>
            </div>

            <section id="install">
                <div class="page-header">
                    <h1>Installation <small></small></h1>
                </div>

                <div class="row" id="install">
                    <div class="span16">
                        <ol class="install">
                            <li>Download the module.</li>
                            <li>Unzip and then run <code>python setup.py install</code>.</li>
                            <li>Yep, that's it.</li>
                        </ol>
                            <p style="text-align: center;">
                                <a class="btn primary" href="https://github.com/dfm/pyest/zipball/master">Download <small>(.zip)</small></a>
                                &nbsp; or &nbsp;
                                <a class="btn" href="https://github.com/dfm/pyest">Fork it on GitHub</a>
                            </p>

                    </div>
                </div>
            </section>

            <section id="quickstart">
                <div class="page-header">
                    <h1>Quickstart <small>Sample code is not documentation&trade;</small></h1>
                </div>

                <div class="row">
                    <div class="span5">
                        <p>Start by defining the probability distribution that you
                        would like to sample.</p>
                        <p>We'll use a
                        <a href="http://en.wikipedia.org/wiki/Multivariate_normal_distribution">multivariate Gaussian</a>.
                        </p>
                    </div>
                    <div class="span11">
                        <pre class="prettyprint">
import numpy as np

def lnprob(x, mu, icov):
    diff = x-mu
    return -np.dot(diff,np.dot(icov,diff))/2.0</pre>
                    </div>
                </div>

                <div class="row">
                    <div class="span5">
                        <p>Let's use <code>10</code> dimensions with some randomly chosen means
                        and covariance matrix.</p>
                        <p><code>cov</code> needs to be positive definite so we make
                        sure that that happens and the take the inverse.</p>
                    </div>
                    <div class="span11">
                        <pre class="prettyprint">
ndim = 10
means = np.random.rand(ndim)
cov  = 0.5-np.random.rand(ndim**2).reshape((ndim, ndim))
cov  = np.triu(cov)
cov += cov.T - np.diag(cov.diagonal())
cov  = np.dot(cov,cov)
icov = np.linalg.inv(cov)</pre>
                    </div>
                </div>

                <div class="row">
                    <div class="span5">
                        <p>Then we guess some initial positions for <code>100</code>
                        <a href="#faq-walkers">walkers</a> and then initialize a
                        new <code>EnsembleSampler</code>.</p>
                        <p>If your <code>lnprob</code> calls are the bottleneck and
                        you have CPU cycles to spare, you can
                        <a href="#faq-multi">use multiprocessing</a>.</p>
                    </div>
                    <div class="span11">
                        <pre class="prettyprint">
nwalkers = 100
p0 = [np.random.rand(ndim) for i in xrange(nwalkers)]

import pyest
sampler = pyest.EnsembleSampler(nwalkers, ndim,lnprob,
                        postargs=[means, icov])</pre>
                    </div>
                </div>

                <div class="row">
                    <div class="span5">
                        <p>Now, let's take 500 steps as a burn-in.</p>
                        <p><span class="label notice">Note</span> <small>each walker is
                        advanced 500 times here so lnprob will actually
                        be called 5x10<sup>4</sup> times here.</small></p>
                    </div>
                    <div class="span11">
                        <pre class="prettyprint">
pos,prob,state = sampler.run_mcmc(p0, None, 500)
sampler.clear_chain()</pre>
                    </div>
                </div>

                <div class="row">
                    <div class="span5">
                        <p>And then, run <code>2000</code> real steps in the chain
                        starting from the final position
                        and random state of the burn-in.</p>
                    </div>
                    <div class="span11">
                        <pre class="prettyprint">
sampler.run_mcmc(pos, state, 2000)</pre>
                    </div>
                </div>

                <div class="row">
                    <div class="span5">
                        <p>The results are stored in a <code>(100, 10, 2000)</code>
                        NumPy array.</p>
                    </div>
                    <div class="span11">
                        <pre class="prettyprint">
sampler.chain</pre>
                    </div>
                </div>

                <div class="row">
                    <div class="span16">
                        <p>
                        You can
                        <a class="btn primary" href="https://github.com/dfm/pyest/blob/master/quickstart.py">
                            get all this code</a>
                        from <a href="https://github.com/dfm/pyest">the GitHub repository</a>.
                        </p>
                    </div>
                </div>

            </section>

            <section id="api">
                <div class="page-header">
                    <h1>API <small></small></h1>
                </div>

<div class="row">
    <div class="span16">
    <h3><small>pyest.</small>EnsembleSampler<small>(nwalkers, npars, lnposteriorfn, postargs=(), a=2.0, outfile=None, clobber=True, outtype='ascii', threads=1, pool=None, nensemble=2)</small></h3>
    </div>
</div>
<div class="row">
    <div class="span13 offset3">
        <h5>Ensemble sampling following Goodman & Weare (2010) with optional parallelization.</h5>
        <p>

        </p>
    </div>
</div>

<div class="row">
    <div class="span2 offset1">
        <h4>Parameters</h4>
    </div>
    <div class="span13">
        <table class="zebra-striped">
            <tr>
                <th width="100">Parameter</td>
                <th width="100">Type</td>
                <th>Description</td>
            </tr>

        <tr>
            <td width="100"><code>nwalkers</code></td>
            <td width="100">int
        </td>
            <td>
        Number of Goodman & Weare "walkers"</td>
        </tr>

        <tr>
            <td width="100"><code>npars</code></td>
            <td width="100">int
        </td>
            <td>
        Number of dimensions in parameter space</td>
        </tr>

        <tr>
            <td width="100"><code>lnposteriorfn</code></td>
            <td width="100">function
        </td>
            <td>
        A function that takes a vector in the parameter space as input and
returns the ln-posterior for that position. If you want to use
multiprocessing, lnposteriorfn *must* be pickleable.</td>
        </tr>

        <tr>
            <td width="100"><code>postargs</code></td>
            <td width="100">tuple
        </td>
            <td>
        Tuple of arguments for lnposteriorfn i.e. ``f(x,*args)``.
Must be a tuple!</td>
        </tr>

        <tr>
            <td width="100"><code>a</code></td>
            <td width="100">float
        </td>
            <td>
        <span class="label notice">Optional</span> The sampler scale (see [1]_)</td>
        </tr>

        <tr>
            <td width="100"><code>outfile</code></td>
            <td width="100">str
        </td>
            <td>
        <span class="label notice">Optional</span> Filename for output.</td>
        </tr>

        <tr>
            <td width="100"><code>outtype</code></td>
            <td width="100">str
        </td>
            <td>
        <span class="label notice">Optional</span> Type of output to write (options "ASCII" or "HDF5")</td>
        </tr>

        <tr>
            <td width="100"><code>clobber</code></td>
            <td width="100">bool
        </td>
            <td>
        <span class="label notice">Optional</span> Overwrite file if it already exists? Otherwise, append. (default: True)</td>
        </tr>

        <tr>
            <td width="100"><code>threads</code></td>
            <td width="100">int
        </td>
            <td>
        <span class="label notice">Optional</span> Number of threads to run. If you wish to run with >1 thread, the
multiprocessing module must be installed in your Python path.</td>
        </tr>

        <tr>
            <td width="100"><code>pool</code></td>
            <td width="100">multiprocessing.Pool
        </td>
            <td>
        <span class="label notice">Optional</span> The Pool to use.  If you do not provide one, one will be created for you.</td>
        </tr>

        </table>
    </div>
</div>


<div class="row">
    <div class="span16">
    <h3><small>pyest.EnsembleSampler.</small>run_mcmc<small>(position, randomstate, iterations, lnprob=None, lnprobinit=None)</small></h3>
    </div>
</div>
<div class="row">
    <div class="span13 offset3">
        <h5>Run a given number of MCMC steps</h5>
        <p>
If you want to run diagnostics between steps or only advance the chain
by one step, use the EnsembleSampler.sample function


        </p>
    </div>
</div>

<div class="row">
    <div class="span2 offset1">
        <h4>Parameters</h4>
    </div>
    <div class="span13">
        <table class="zebra-striped">
            <tr>
                <th width="100">Parameter</td>
                <th width="100">Type</td>
                <th>Description</td>
            </tr>

        <tr>
            <td width="100"><code>position</code></td>
            <td width="100">list
        <br>  (nwalkers, npars)</td>
            <td>
        A list of the positions of the walkers in the parameter space</td>
        </tr>

        <tr>
            <td width="100"><code>randomstate</code></td>
            <td width="100">tuple
        </td>
            <td>
        Returned by the get_state() function of numpy.random.mtrand.RandomState</td>
        </tr>

        <tr>
            <td width="100"><code>iterations</code></td>
            <td width="100">int
        </td>
            <td>
        Number of steps to run in the Markov chain</td>
        </tr>

        <tr>
            <td width="100"><code>lnprob</code></td>
            <td width="100">list
        <br> (nwalkers)</td>
            <td>
        <span class="label notice">Optional</span> The list of log posterior probabilities for the walkers at positions
given by the position parameter. If lnprobinit is None, the initial
values are calculated using ensemble_lnposterior(position).</td>
        </tr>

        <tr>
            <td width="100"><code>lnprobinit</code></td>
            <td width="100">list
        <br>  (nwalkers)</td>
            <td>
        Superseded by lnprob.</td>
        </tr>

        </table>
    </div>
</div>

<div class="row">
    <div class="span2 offset1">
        <h4>Returns</h4>
    </div>
    <div class="span13">
        <table class="zebra-striped">

        <tr>
            <td width="100"><code>pos</code></td>
            <td width="100">list
        <br>  (nwalkers, npars)</td>
            <td>
        The list of the _final_ positions of the walkers.</td>
        </tr>

        <tr>
            <td width="100"><code>lnprob</code></td>
            <td width="100">list
        <br>  (nwalkers)</td>
            <td>
        A list of all of the log posterior probabilities for the walkers at
the _final_ position.</td>
        </tr>

        <tr>
            <td width="100"><code>state</code></td>
            <td width="100">tuple
        </td>
            <td>
        The state of the random number generator at the end of the run.</td>
        </tr>

        </table>
    </div>
</div>


<div class="row">
    <div class="span16">
    <h3><small>pyest.EnsembleSampler.</small>sample<small>(position0, lnprob, randomstate)</small></h3>
    </div>
</div>
<div class="row">
    <div class="span13 offset3">
        <h5>Advances the chain N steps as an iterator</h5>
        <p>
By default, it will only advance the chain by one step but if you're
going to run multiple steps, the EnsembleSampler.run_mcmc or iterator
version of this function have less overhead.


        </p>
    </div>
</div>

<div class="row">
    <div class="span2 offset1">
        <h4>Parameters</h4>
    </div>
    <div class="span13">
        <table class="zebra-striped">
            <tr>
                <th width="100">Parameter</td>
                <th width="100">Type</td>
                <th>Description</td>
            </tr>

        <tr>
            <td width="100"><code>position0</code></td>
            <td width="100">list
        <br>  (nwalkers, npars)</td>
            <td>
        A list of the initial positions of the walkers in the parameter space</td>
        </tr>

        <tr>
            <td width="100"><code>lnprob</code></td>
            <td width="100">list
        <br>  (nwalkers)</td>
            <td>
        The list of log posterior probabilities for the walkers at positions
given by the position parameter. If it is None, the initial
values are calculated using ensemble_lnposterior(position).</td>
        </tr>

        <tr>
            <td width="100"><code>randomstate</code></td>
            <td width="100">tuple
        </td>
            <td>
        Returned by the get_state() function of numpy.random.mtrand.RandomState</td>
        </tr>

        <tr>
            <td width="100"><code>iterations</code></td>
            <td width="100">int
        </td>
            <td>
        <span class="label notice">Optional</span> Number of steps to run in the Markov chain</td>
        </tr>

        </table>
    </div>
</div>

<div class="row">
    <div class="span2 offset1">
        <h4>Returns</h4>
    </div>
    <div class="span13">
        <table class="zebra-striped">

        <tr>
            <td width="100"><code>pos</code></td>
            <td width="100">list
        <br>  (nwalkers, npars)</td>
            <td>
        The list of the _final_ positions of the walkers.</td>
        </tr>

        <tr>
            <td width="100"><code>lnprob</code></td>
            <td width="100">list
        <br>  (nwalkers)</td>
            <td>
        A list of all of the log posterior probabilities for the walkers at
the _final_ position.</td>
        </tr>

        <tr>
            <td width="100"><code>state</code></td>
            <td width="100">tuple
        </td>
            <td>
        The state of the random number generator at the end of the run.</td>
        </tr>

        </table>
    </div>
</div>


<div class="row">
    <div class="span16">
    <h3><small>pyest.EnsembleSampler.</small>clear_chain<small>()</small></h3>
    </div>
</div>
<div class="row">
    <div class="span13 offset3">
        <h5>Clear the chain and some other stats so that the class can be reused</h5>
        <p>
This can be especially useful after a burn-in phase, for example.



        </p>
    </div>
</div>


<div class="row">
    <div class="span16">
    <h3><small>pyest.EnsembleSampler.</small>ensemble_lnposterior<small>(pos)</small></h3>
    </div>
</div>
<div class="row">
    <div class="span13 offset3">
        <h5>Return the ln-posterior probability for all the walkers</h5>
        <p>
This step is run in parallel if the sampler was initialized with > 1 threads.


        </p>
    </div>
</div>

<div class="row">
    <div class="span2 offset1">
        <h4>Parameters</h4>
    </div>
    <div class="span13">
        <table class="zebra-striped">
            <tr>
                <th width="100">Parameter</td>
                <th width="100">Type</td>
                <th>Description</td>
            </tr>

        <tr>
            <td width="100"><code>pos</code></td>
            <td width="100">list
        <br>  (nwalkers, npars)</td>
            <td>
        A list of the positions of the walkers in the parameter space</td>
        </tr>

        </table>
    </div>
</div>

<div class="row">
    <div class="span2 offset1">
        <h4>Returns</h4>
    </div>
    <div class="span13">
        <table class="zebra-striped">

        <tr>
            <td width="100"><code>lnposterior</code></td>
            <td width="100">list
        <br>  (nwalkers)</td>
            <td>
        A list of the log posterior values for each of the walkers</td>
        </tr>

        </table>
    </div>
</div>

            </section>

            <section id="faq">
                <div class="page-header">
                    <h1>Frequently asked questions <small></small></h1>
                </div>

                <div class="row" id="faq-walkers">
                    <div class="span5">
                        <p><strong>What are you talking about when you say "walkers"?</strong></p>
                    </div>
                    <div class="span11">
                        Walkers are ...
                    </div>
                </div>
            </section>

            <footer>
            <p style="text-align: center;"><a href="http://danfm.ca">Dan Foreman-Mackey</a>,
            Dustin Lang, David W. Hogg, <em>et al.</em></p>
            </footer>

        </div> <!-- /container -->

        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>
        <script type="text/javascript" src="prettify.js"></script>
        <script>$(function () { prettyPrint() })</script>


    </body>
</html>

